
name: Build and Publish image
run-name: ${{ github.actor }} is publishing a new Docker image 🚀

# Event that trigger workflow
on:
  push:
    branches:
      - main
  # to run a workflow manually, configure your workflow to run on workflow_dispatch in the default branch

jobs: 
  publish_images:
    runs-on: ubuntu-latest
    steps:
    - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
    - name: Check out repository code
      uses: actions/checkout@v4
    - run: |
        echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
        echo "🖥️ The workflow is now ready to test your code on the runner."
    - name: Build image
      run: |
        docker build . -t zhaohuiwang/deployment-template:latest
        echo "🎉 The Docker build succeed."
    - name: Push image to docker hub
      run: |
        docker login -u zhaohuiw -p ${{ secrets.DH_PAT }} 
        docker push zhaohuiwang/deployment-template:latest
        echo "🎉 The Docker image was pushed to docker hub."
      # login Dockerhub
    - run: echo "🍏 This job's status is ${{ job.status }}."
